# pivot_커뮤니티 WUB 시트 자동 수식 적용 가이드

## 📋 개요

이 Apps Script는 `pivot_커뮤니티 WUB` 시트에서 행이 추가될 때마다 다음 열에 수식을 자동으로 적용합니다:

- **H열**: WoW(pv) - 전주 대비 변화율 (`=C3/C2-1` 형식, 3행부터)
- **O열**: 커뮤니티 WUB - 합계 (`=B10+K10` 형식, 10행부터)
- **P열**: 커뮤니티 WPV - 합계 (`=C2+L2` 형식, 2행부터)
- **Q열**: WoW(wub) - 전주 대비 변화율 (`=O3/O2-1` 형식, 3행부터)
- **S열**: WoW(wpv) - 전주 대비 변화율 (`=P14/P13-1` 형식, 14행부터)
- **U열**: 전체 WUB 대비(커뮤니티) - 비율 (`=AA2/X2` 형식, 2행부터)

**참고**: G, I, R, T열에는 현재 수식이 없어 제외되었습니다. 필요시 추가 가능합니다.

---

## 🚀 설치 방법

### 1단계: Apps Script 에디터 열기

1. Google Sheets에서 해당 스프레드시트를 엽니다
2. 상단 메뉴에서 **Extensions(확장 프로그램)** > **Apps Script** 클릭
3. 새로운 탭에서 Apps Script 에디터가 열립니다

### 2단계: 코드 복사 및 붙여넣기

1. `pivot-wub-apps-script.js` 파일의 전체 내용을 복사합니다
2. Apps Script 에디터의 기본 함수를 모두 삭제하고 붙여넣습니다
3. **Ctrl+S** (또는 **Cmd+S**)로 저장합니다
4. 프로젝트 이름을 "pivot_커뮤니티 WUB 자동 수식" 등으로 변경할 수 있습니다

### 3단계: 권한 부여 및 실행

1. 상단 메뉴에서 **실행(Run)** > **applyAllFormulas** 선택
2. 처음 실행 시 권한 요청 팝업이 나타납니다
3. **권한 검토** 클릭
4. Google 계정 선택
5. **고급** > **안전하지 않은 페이지로 이동** 클릭 (필요시)
6. **허용** 클릭하여 권한 부여

### 4단계: 초기 수식 적용

1. 권한 부여 후 다시 **실행(Run)** > **applyAllFormulas** 선택
2. 실행 로그에서 "수식 적용 완료" 메시지 확인
3. Google Sheets로 돌아가서 수식이 올바르게 적용되었는지 확인

---

## ⚙️ 트리거 설정 (선택사항)

행이 추가될 때마다 자동으로 수식이 적용되도록 하려면 트리거를 설정합니다:

### 방법 1: onEdit 트리거 (간단하지만 성능 이슈 가능)

1. Apps Script 에디터에서 왼쪽 메뉴의 **트리거(Triggers)** 클릭
2. **트리거 추가(+)** 클릭
3. 설정:
   - **실행할 함수**: `onEdit`
   - **이벤트 소스**: **스프레드시트에서**
   - **이벤트 유형**: **편집 시**
4. **저장** 클릭

**주의**: onEdit는 모든 편집 시 실행되므로 성능에 영향을 줄 수 있습니다.

### 방법 2: 시간 기반 트리거 (권장)

1. Apps Script 에디터에서 왼쪽 메뉴의 **트리거(Triggers)** 클릭
2. **트리거 추가(+)** 클릭
3. 설정:
   - **실행할 함수**: `applyAllFormulas`
   - **이벤트 소스**: **시간 기반**
   - **이벤트 유형**: **시간 기반 트리거**
   - **시간 간격**: **매일 1회** 또는 **매시간** (선택)
4. **저장** 클릭

### 방법 3: 수동 실행 (가장 안전)

트리거를 설정하지 않고 필요할 때만 수동으로 실행:

1. Apps Script 에디터에서 **실행(Run)** > **applyAllFormulas** 선택
2. 또는 Google Sheets에서 **Extensions(확장 프로그램)** > **Apps Script** > **수식 자동 적용** > **전체 수식 적용** 메뉴 사용

---

## 📝 사용 가능한 함수

### `applyAllFormulas()`
- 시트의 모든 행에 수식을 적용합니다
- 수동 실행 또는 트리거로 실행 가능
- **권장**: 정기적으로 실행하거나 데이터 추가 후 실행

### `applyFormulasToRange(startRow, endRow)`
- 특정 행 범위에만 수식을 적용합니다
- 예: `applyFormulasToRange(50, 100)` - 50행부터 100행까지

### `onEdit(e)`
- 시트 편집 시 자동 실행 (트리거 필요)
- pivot_커뮤니티 WUB 시트에서만 작동

### `onOpen()`
- 시트를 열 때 실행
- 메뉴에 "수식 자동 적용" 항목 추가

---

## 🔧 수식 패턴 설명

### H열: WoW(pv) - 전주 대비 변화율
```
=IF(ISBLANK(C3), "", IF(C2=0, "", C3/C2-1))
```
- 3행부터 시작
- C열의 현재 주 값을 전주 값으로 나누어 변화율 계산
- 빈 셀이나 0으로 나누기 방지

### O열: 커뮤니티 WUB - 합계
```
=B10+K10
```
- 10행부터 시작
- B열(프로필 WUB) + K열(피드 WUB)

### P열: 커뮤니티 WPV - 합계
```
=C2+L2
```
- 2행부터 시작
- C열(프로필 WPV) + L열(피드 WPV)

### Q열: WoW(wub) - 전주 대비 변화율
```
=IF(ISBLANK(O3), "", IF(O2=0, "", O3/O2-1))
```
- 3행부터 시작
- O열의 현재 주 값을 전주 값으로 나누어 변화율 계산

### S열: WoW(wpv) - 전주 대비 변화율
```
=IF(ISBLANK(P14), "", IF(P13=0, "", P14/P13-1))
```
- 14행부터 시작
- P열의 현재 주 값을 전주 값으로 나누어 변화율 계산

### U열: 전체 WUB 대비(커뮤니티) - 비율
```
=IF(ISBLANK(AA2), "", IF(X2=0, "", AA2/X2))
```
- 2행부터 시작
- AA열을 X열로 나누어 비율 계산

---

## ⚠️ 주의사항

1. **성능**: 대량의 데이터가 있는 경우 batchUpdate 방식을 사용하므로 성능이 최적화되어 있습니다.

2. **기존 수식 덮어쓰기**: 이 스크립트는 해당 열의 모든 수식을 덮어씁니다. 수동으로 수정한 수식이 있다면 주의하세요.

3. **트리거 제한**: onEdit 트리거는 6분/사용자/스크립트 실행 시간 제한이 있습니다. 대량 편집 시 문제가 될 수 있습니다.

4. **권한**: 스크립트는 스프레드시트 편집 권한이 필요합니다.

---

## 🐛 문제 해결

### 수식이 적용되지 않아요
1. Apps Script 에디터에서 실행 로그 확인
2. 권한이 올바르게 부여되었는지 확인
3. 시트 이름이 정확히 "pivot_커뮤니티 WUB"인지 확인

### 성능이 느려요
1. onEdit 트리거 대신 시간 기반 트리거 사용
2. 또는 수동 실행 방식으로 변경

### 오류가 발생해요
1. Apps Script 에디터의 실행 로그 확인
2. 시트에 필요한 열(B, C, K, L, X, AA)이 있는지 확인
3. 데이터 형식이 올바른지 확인

---

## 📞 추가 지원

문제가 지속되면 다음을 확인하세요:
- Apps Script 실행 로그
- Google Sheets의 수식 오류 표시
- 시트 구조 및 데이터 형식
